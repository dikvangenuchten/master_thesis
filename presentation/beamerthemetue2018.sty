\RequirePackage{beamerbasethemes}
\RequirePackage{ifthen}
\RequirePackage{pgfpages}
\RequirePackage{xcolor}
\RequirePackage{multicol,bigstrut}
\RequirePackage{colortbl}

\DeclareOptionBeamer{theme}
{\PassOptionsToPackage{theme=#1}{beamercolorthemetue2018plain}}

\DeclareOptionBeamer{tuelogo}
{\PassOptionsToPackage{tuelogo=#1}{beamerouterthemetue2018plain}}

\DeclareOptionBeamer{compress}{\beamer@compresstrue}

\DeclareOptionBeamer{calibri}
{\PassOptionsToPackage{calibri=#1}{beamerfontthemetue2018plain}}

\newcommand{\spp}{1}
\DeclareOptionBeamer{slidesperpage}{\renewcommand{\spp}{#1}}

\only<handout>{
  \renewcommand{\spp}{2}
}


\ProcessOptionsBeamer

\pgfpagesdeclarelayout{3 on 1}
{
  \edef\pgfpageoptionheight{\the\paperwidth} % landscaped by default
  \edef\pgfpageoptionwidth{\the\paperheight}
  \def\pgfpageoptionborder{0pt}
  \def\pgfpageoptionfirstshipout{1}
}
{
  \pgfpagesphysicalpageoptions
  {%
    logical pages=3,%
    physical height=\pgfpageoptionheight,%
    physical width=\pgfpageoptionwidth,%
    current logical shipout=\pgfpageoptionfirstshipout%
  }
  \ifdim\paperheight>\paperwidth\relax
    % put side-by-side
    \pgfpageslogicalpageoptions{1}
    {%
      border shrink=\pgfpageoptionborder,%
      resized width=.33\pgfphysicalwidth,%
      resized height=\pgfphysicalheight,%
      center=\pgfpoint{.1667\pgfphysicalwidth}{.5\pgfphysicalheight}%
    }%
    \pgfpageslogicalpageoptions{2}
    {%
      border shrink=\pgfpageoptionborder,%
      resized width=.33\pgfphysicalwidth,%
      resized height=\pgfphysicalheight,%
      center=\pgfpoint{.5\pgfphysicalwidth}{.5\pgfphysicalheight}%
    }%
    \pgfpageslogicalpageoptions{3}
    {%
      border shrink=\pgfpageoptionborder,%
      resized width=.33\pgfphysicalwidth,%
      resized height=\pgfphysicalheight,%
      center=\pgfpoint{.8333\pgfphysicalwidth}{.5\pgfphysicalheight}%
    }%
  \else
    % stack on top of one another
    \pgfpageslogicalpageoptions{1}
    {%
      border shrink=\pgfpageoptionborder,%
      resized width=\pgfphysicalwidth,%
      resized height=.33\pgfphysicalheight,%
      center=\pgfpoint{.5\pgfphysicalwidth}{.8333\pgfphysicalheight}%
    }%
    \pgfpageslogicalpageoptions{2}
    {%
      border shrink=\pgfpageoptionborder,%
      resized width=\pgfphysicalwidth,%
      resized height=.33\pgfphysicalheight,%
      center=\pgfpoint{.5\pgfphysicalwidth}{.5\pgfphysicalheight}%
    }%
    \pgfpageslogicalpageoptions{3}
    {%
      border shrink=\pgfpageoptionborder,%
      resized width=\pgfphysicalwidth,%
      resized height=.33\pgfphysicalheight,%
      center=\pgfpoint{.5\pgfphysicalwidth}{.1667\pgfphysicalheight}%
    }%
  \fi
}

\pgfpagesdeclarelayout{6 on 1a}
{
  \edef\pgfpageoptionheight{\the\paperwidth} % landscaped by default
  \edef\pgfpageoptionwidth{\the\paperheight}
  \def\pgfpageoptionborder{0pt}
  \def\pgfpageoptionfirstshipout{1}
}
{
  \pgfpagesphysicalpageoptions
  {%
    logical pages=6,%
    physical height=\pgfpageoptionheight,%
    physical width=\pgfpageoptionwidth,%
    current logical shipout=\pgfpageoptionfirstshipout%
  }
  \ifdim\paperheight>\paperwidth\relax
    % put side-by-side
    \pgfpageslogicalpageoptions{1}
    {%
      border shrink=\pgfpageoptionborder,%
      resized width=.5\pgfphysicalwidth,%
      resized height=\pgfphysicalheight,%
      center=\pgfpoint{.1667\pgfphysicalwidth}{.25\pgfphysicalheight}%
    }%
    \pgfpageslogicalpageoptions{3}
    {%
      border shrink=\pgfpageoptionborder,%
      resized width=.5\pgfphysicalwidth,%
      resized height=\pgfphysicalheight,%
      center=\pgfpoint{.5\pgfphysicalwidth}{.25\pgfphysicalheight}%
    }%
    \pgfpageslogicalpageoptions{5}
    {%
      border shrink=\pgfpageoptionborder,%
      resized width=.5\pgfphysicalwidth,%
      resized height=\pgfphysicalheight,%
      center=\pgfpoint{.8333\pgfphysicalwidth}{.25\pgfphysicalheight}%
    }%
    \pgfpageslogicalpageoptions{2}
    {%
      border shrink=\pgfpageoptionborder,%
      resized width=.5\pgfphysicalwidth,%
      resized height=\pgfphysicalheight,%
      center=\pgfpoint{.1667\pgfphysicalwidth}{.75\pgfphysicalheight}%
    }%
    \pgfpageslogicalpageoptions{4}
    {%
      border shrink=\pgfpageoptionborder,%
      resized width=.5\pgfphysicalwidth,%
      resized height=\pgfphysicalheight,%
      center=\pgfpoint{.5\pgfphysicalwidth}{.75\pgfphysicalheight}%
    }%
    \pgfpageslogicalpageoptions{6}
    {%
      border shrink=\pgfpageoptionborder,%
      resized width=.5\pgfphysicalwidth,%
      resized height=\pgfphysicalheight,%
      center=\pgfpoint{.8333\pgfphysicalwidth}{.75\pgfphysicalheight}%
    }%
  \else
    % stack on top of one another
    \pgfpageslogicalpageoptions{1}
    {%
      border shrink=\pgfpageoptionborder,%
      resized width=0.5\pgfphysicalwidth,%
      resized height=\pgfphysicalheight,%
      center=\pgfpoint{.25\pgfphysicalwidth}{.8333\pgfphysicalheight}%
    }%
    \pgfpageslogicalpageoptions{3}
    {%
      border shrink=\pgfpageoptionborder,%
      resized width=0.5\pgfphysicalwidth,%
      resized height=\pgfphysicalheight,%
      center=\pgfpoint{.25\pgfphysicalwidth}{.5\pgfphysicalheight}%
    }%
    \pgfpageslogicalpageoptions{5}
    {%
      border shrink=\pgfpageoptionborder,%
      resized width=0.5\pgfphysicalwidth,%
      resized height=\pgfphysicalheight,%
      center=\pgfpoint{.25\pgfphysicalwidth}{.1667\pgfphysicalheight}%
    }%
    \pgfpageslogicalpageoptions{2}
    {%
      border shrink=\pgfpageoptionborder,%
      resized width=0.5\pgfphysicalwidth,%
      resized height=\pgfphysicalheight,%
      center=\pgfpoint{.75\pgfphysicalwidth}{.8333\pgfphysicalheight}%
    }%
    \pgfpageslogicalpageoptions{4}
    {%
      border shrink=\pgfpageoptionborder,%
      resized width=0.5\pgfphysicalwidth,%
      resized height=\pgfphysicalheight,%
      center=\pgfpoint{.75\pgfphysicalwidth}{.5\pgfphysicalheight}%
    }%
    \pgfpageslogicalpageoptions{6}
    {%
      border shrink=\pgfpageoptionborder,%
      resized width=0.5\pgfphysicalwidth,%
      resized height=\pgfphysicalheight,%
      center=\pgfpoint{.75\pgfphysicalwidth}{.1667\pgfphysicalheight}%
    }%
  \fi
}

\ifthenelse{\equal{\spp}{2}}{\pgfpagesuselayout{2 on 1}[a4paper,border shrink=5mm]}{}
\ifthenelse{\equal{\spp}{3}}{\pgfpagesuselayout{3 on 1}[a4paper,border shrink=5mm]}{}
\ifthenelse{\equal{\spp}{4}}{\pgfpagesuselayout{4 on 1}[a4paper,border shrink=5mm,landscape]}{}
\ifthenelse{\equal{\spp}{6}}{\pgfpagesuselayout{6 on 1a}[a4paper,border shrink=5mm]}{}

\newenvironment{slide}{\begin{frame}[fragile,environment=slide]\vfill}{\vfill\end{frame}}
\newenvironment{slidetop}{\begin{frame}[fragile,environment=slidetop]}{\end{frame}}
\newenvironment{titleframe}[1][]{\usebackgroundtemplate{\tstdrawtitlebackground[#1]}\begin{frame}[fragile,environment=titleframe]}{\end{frame}\usebackgroundtemplate{\drawbackground}}
\newenvironment{titleslide}[1][]{\begin{titleframe}[#1]}{\end{titleframe}}
\newenvironment{imageframe}[1][]{\usebackgroundtemplate{\tstdrawbackground[#1]}\begin{frame}[fragile,environment=imageframe]}{\end{frame}\usebackgroundtemplate{\drawbackground}}
\newenvironment{imageslide}[1][]{\begin{imageframe}[#1]}{\end{imageframe}}
\newenvironment{chapterframe}[1][]{
  \setbeamercolor{frametitle}{fg=chapterslidefgcolor}
  \setbeamercolor{structure}{fg=chapterslidefgcolor}
  \setbeamercolor{normal text}{fg=chapterslidefgcolor}
  \setbeamercolor{math text}{fg=chapterslidefgcolor}
  \definecolor{beamerstructure}{named}{chapterslidefgcolor}
  \setbeamercolor{itemize/enumerate body}{fg=chapterslidefgcolor}
  \setlength{\extraheadlineskip}{0.5\cm}
  \definecolor{slidebgcolor}{named}{chapterslidebgcolor}
  %\usebackgroundtemplate{\tstdrawchapterbackground[#1]}%
  \begin{frame}[fragile,environment=chapterframe]\color{chapterslidefgcolor}%
    }{\end{frame}\usebackgroundtemplate{\drawbackground}}
\newenvironment{chapterslide}[1][]{\begin{chapterframe}[#1]}{\end{chapterframe}}

\newcommand{\dept}{}
\newcommand{\department}[1]{\renewcommand{\dept}{#1}}

\newcommand{\companylogo}{}
\newcommand{\companylogosizemultiplicationfactor}{1}
\definecolor{companymaincolor}{rgb}{0,0,0}
\newlength{\basecompanylogowidth}
\newcommand{\company}[2]{%
  \renewcommand{\companylogo}{#1}%
  \definecolor{companymaincolor}{named}{#2}
  \definecolor{themecolor}{named}{#2}
  \definecolor{chapterslidebgcolor}{named}{#2}
}



\mode<presentation>


\useinnertheme{default}
\useoutertheme{tue2018plain}
\usecolortheme{tue2018plain}
\usefonttheme{tue2018plain}

\setbeamersize{text margin left=\lefttitlemargin,text margin right=\lefttitlemargin}

\hypersetup{
  colorlinks=true,
  linkcolor=tuecyan,
  urlcolor=tuecyan,
}

\mode<all>
